<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Details</title>
</head>

<body>
    <h1>User Details</h1>
    <div id="userDetails"></div>
    <form id="updateDietForm">
        <label for="diet_plan">Write Diet Plan for user:</label>
        <textarea type="text" id="diet_plan" name="diet_plan" rows="5"></textarea><br><br>

        <label for="healthscore">Give Healthscore for user</label>
        <input type="number" id="healthscore" name="healthscore"><br><br>

        <input type="hidden" id="email" name="email">

        <button type="submit">Submit</button>
    </form>

    <script>
        // Fetch user details based on email parameter from URL
        const urlParams = new URLSearchParams(window.location.search);
        const email = urlParams.get('email');
        console.log(email)
        document.getElementById("email").value = email;
        fetch(`/userDetails?email=${email}`)
            .then(response => response.json())
            .then(user => {
                // Display user details on the page
                const userDetailsDiv = document.getElementById('userDetails');
                userDetailsDiv.innerHTML = `
                    <p><strong>Name:</strong> ${user.name}</p>
                    <p><strong>Age:</strong> ${user.age}</p>
                    <p><strong>Email:</strong> ${user.email}</p>
                    <p><strong>Diet Plan:</strong> ${user.diet_plan}</p>
                    <!-- Add more user details here -->
                `;
            })
            .catch(error => {
                console.error('Error fetching user details:', error);
            });
    </script>
    <script>
        document.getElementById('updateDietForm').addEventListener('submit', function (event) {
            event.preventDefault(); // Prevent the form from submitting normally

            // Get form data
            var formData = new FormData(this);
            console.log(formData)
            // Send form data to server
            fetch('/updateDiet', {
                method: 'POST',
                body: formData
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Clear the form input
                    document.getElementById('diet_plan').value = '';
                    document.getElementById('healthscore').value = '';

                    // Display success message
                    alert('Diet Plan updated successfully!');
                })
                .catch(error => {
                    // Display error message
                    alert('Oops! Something went wrong. Please try again later.');
                });
        });
    </script>
</body>

</html>